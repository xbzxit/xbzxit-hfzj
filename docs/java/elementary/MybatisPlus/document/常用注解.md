# 常用注解

## 指定表

> 指定表名， 默认是类名小写就是表名 ， 带下划线会自动替换并大写

```java
@TableName
public class User {
}

@TableName("user")
public class User {
}


@TableName("t_user")
public class User {
}


@TableName("t_user")
public class TUser {
}
```

* 全局配置

```yaml
global-config:
    db-config:
        # 配置MyBatis-Plus操作表的默认前缀
        table-prefix: t_
```

## 指定主键

> 主键生成策略 mybatis默认生成的id 是使用雪花算法

### value属性

> 表 主键为 uid

```java
@TableId(value="uid")


@TableId("uid")
```

### type属性

> 定义主键的生成策略

* 默认

```java
IdType.ASSIGN_ID

该策略采用雪花ID
```

* 自递

```java
IdType.AUTO

数据库主键必须设置了自增，  否则该策略无效
```

* 全局配置主键生成策略

```yaml
global-config:
  db-config:
    # 配置MyBatis-Plus的主键策略
    id-type: auto
```

## 指定数据库字段

```java
    @TableField("name")
    private String name;
```

### 列更新时值更新

```java
@TableField(fill = FieldFill.UPDATE)
```

### 列新增或者更新时值变化

```java
 @TableField(fill = FieldFill.INSERT_UPDATE)
```

### 忽略不是数据库的字段

```java
@TableField(exist = false)
```

## 逻辑删除

### 表新增一列 is_deleted

![image.png](./assets/1672838247034-image.png)

### 对应的属性加注解

```java
 @TableLogic
 private Integer isDeleted;
```

### 测试

> 删除为更新 is_deleted = 1
>
> 查询只会查询 删除标记为0的， 如果为1 或者 null 不查询

```java
    @Test
    public void testDel(){
        User user = new User();
        user.setId(7L);
        userService.removeById(user);
    }
```

## Mapper接口查询注解

```java
@Select("SELECT * FROM test_role_item WHERE role_id = #{roleId}")
List<RoleItemDTO> listByRoleId(@Param("roleId") int roleId);




@Results({
    @Result(property = "vid",         column = "id"),
    @Result(property = "villageName", column = "name"),
    @Result(property = "district",    column = "district", typeHandler = ArrayTypeHandler.class)
})
@Select("SELECT id, name, district from village WHERE id = #{id}")
Village selectVillage(int id);



@Select({"select * from u_user"})
@ResultMap("userMap")


String PARAMS = "<if test='param != null'>" +
        "<if test='param.itemType != null'>AND item_type = #{param.itemType}</if>" +
        "<if test='param.itemName != null'>AND item_name = #{param.itemName}</if>" +
        "</if>";

@Select("<script>SELECT item_type, item_name, create_time" +
        " FROM ${tableName} <where>" + PARAMS + "</where>" +
        " <if test='pager != null'>${pager.sql}</if>" +
        "</script>")
List<Item> list(
@Param("tableName") String tableName,
@Param("param") Map<String, Object> param,
@Param("pager") Pager pager);





```

## Mapper接口新增注解

```java
@Insert("INSERT into village(name,district) VALUES(#{villageName}, #{district})")
void insertVillage(Village village);


@Insert("INSERT INTO role_item (role_id, item_id, create_time) VALUES (#{po.roleId}, #{po.itemId}, #{po.createTime})")
@Options(useGeneratedKeys=true, keyProperty="id")
int insert(@Param("po") RoleItemPO po);


```

## Mapper接口更新注解

```java
@Update("UPDATE village SET name=#{villageName}, district =#{district} WHERE id =#{vid}")
void updateVillage(Village village);


@Update("update widget set name=#{po.name}, manufacturer=#{po.manufacturer} where id=#{id}")
public void updateById(@Param("id") int id, @Param("po") Widget po);

```

## Mapper接口删除注解

```java
@Delete("DELETE FROM village WHERE id =#{id}")
void deleteVillage(int id);
```

## 注解中加foreach
```java
@Mapper
public interface LizzMapper {
    @Select({"<script> select id,name " +
            " from t_lizz" +
            " where id in" +
            " <foreach collection=\"ids\" index=\"index\" item=\"item\" open=\"(\" separator=\",\" close=\")\">" +
            "        #{item}" +
            " </foreach>" +
            "</script>"})
    List<Lizz> selectByIds(List<Integer> ids);
 
    @Insert({"<script> insert into t_lizz(id,name)" +
            " values" +
            " <foreach collection=\"datas\" item=\"item\" separator=\",\" >(#{item.id},#{item.name})</foreach>" +
            "</script>"})
    int batchInsert(List<Lizz> datas);
 
    @Select({"<script> select id,name " +
            " from t_lizz" +
            " where id in" +
            " <foreach collection=\"ids.split(',')\" index=\"index\" item=\"item\" open=\"(\" separator=\",\" close=\")\">#{item}</foreach>" +
            "<if test='state != null'>and state= #{state}</if> " +
            "</script>"})
    List<AlertRule> listByIdsAndState(String ids, Integer state);
}

```
